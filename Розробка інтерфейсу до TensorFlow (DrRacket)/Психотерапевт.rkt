#lang racket
(define (Лікар імя)
 (print (list 'Доброго-дня імя))
 (print '(Як справи?))
 (запустити-цикл-лікар імя))

(define (пацієнт)
(print '(До побачення))
(print '(Наступний!))
(print '(Представтесь, будь ласка))
(Лікар (car (read)))
  ) 

(define (запустити-цикл-лікар імя)
 (newline)
 (print '**)
 (let ((скарга (read)))
   (cond ((equal? скарга '(до побачення))
          (пацієнт))
         ((equal? скарга '(вечір))
          (printf "До побачення, ~v. Побачимося наступного тижня." імя))
         (else (and (print (відповісти скарга)) (set! список-скарг (append список-скарг (list скарга))))
               (запустити-цикл-лікар імя)))))

(define (відповісти скарга)
 (cond ((= (50-50) 0) (append (уточнити)
                        (зміна-особи скарга)))
       ((= (50-50) 1) (append (попередні-відповіді) (зміна-особи (вибір-випадку список-скарг))))
       (else (продовжити))))

(define (50-50)
 (random 3) )

(define (уточнити)
 (вибір-випадку '((Здається, Ви думаєте, що)
                  (Ви відчуваєте, що)
                  (Чому Ви вважаєте, що)
                  (Чому Ви говорите, що)
                  (Чому Ви думаєте, що)
                  (Чому Вам здається, що))))

(define (продовжити)
 (вибір-випадку '((Будь ласка, продовжуйте)
                  (Багато людей відчувають це ж саме)
                  (Багато людей вважають так само)
                  (Будь ласка, далі)
                  (Я слухаю вас, продовжуйте))))

(define (попередні-відповіді)
  (вибір-випадку '((Раніше Ви думали, що)
                   (Ви говорили, що)
                   (Ви відчували, що))))

(define список-скарг '())

(define (зміна-особи фраза) 
 (замінити-все '((я _ви) (мені _вам) (мною _вами)
                        (моє _ваше) (мене _вас) (мій _ваш)
                        (моя _ваша) (мої _ваші)
                   (ви _я) (ти _я) 
                   (вам _мені) (тобі _мені)
                   (вами _мною) (тобою _мною)
                   (ваше _моє) (твоє _моє)
                   (вас _мене) (тебе _мене)
                   (ваш _мій) (твій _мій)
                   (ваша _моя) (твоя _моя)
                   (ваші _мої) (твої _мої))
                фраза)
  (замінити-все '((_ви ви) (_вам вам) (_вами вами)
                        (_ваше ваше) (_вас вас) (_ваш ваш)
                        (_ваша ваша) (_ваші ваші)
                   (_я я) 
                   (_мені мені)
                   (_мною мною)
                   (_моє моє)
                   (_мене мене)
                   (_мій мій)
                   (_моя моя)
                   (_мої мої))
                фраза))

(define (замінити-все пари список)
 (cond ((null? пари) список)
       (else (let ((стар-нов (car пари)))
               (замінити (car стар-нов)
                         (cadr стар-нов)
                         (замінити-все (cdr пари)
                                       список))))))

(define (замінити старий новий список)
 (cond ((null? список) '())
       ((equal? (car список) старий)
        (cons новий
              (замінити старий новий (cdr список))))
       (else (cons (car список)
                   (замінити старий новий (cdr список))))))

(define (вибір-випадку список)
 (list-ref список (random (length список))))



